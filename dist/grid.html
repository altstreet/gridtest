<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Grid Test</title>

    <!-- Bootstrap -->
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/font-awesome.min.css" rel="stylesheet">
    <link href="css/main.css" rel="stylesheet">

     

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>
  <body>

    
    <header class="header-section">
      <div class="container">
        <div class="navbar navbar-fixed-top navbar-float" role="navigation">
          <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target=".navbar-collapse">
              <span class="sr-only">Toggle navigation</span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="index.html">GridTest</a>
          </div>
          <div class="collapse navbar-collapse">
            <ul class="nav navbar-nav">
              <li><a href="grid.html">Grid</a></li>
              <li><a href="about.html">About</a></li>
              <li><a href="products.html">Products</a></li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
              <li><a href="#">Register</a></li>
              <li><a href="#">Login</a></li>
            </ul>
          </div><!--/.nav-collapse -->
        </div>
      </div>
    </header>
    

    

<section class="leading-section">
    <div class="container">
        <h2>Grid Test</h2>
    </div>
</section>



<section class="section-white">

    <div class="container">
        <div class="row vertical-menu-parent">
            <div class="col-sm-3 hidden-xs">

            <div class="panel panel-default">
			  <div class="panel-heading">Sort By:</div>
			  <div class="panel-body">		    
                <div class="radio">
				  <label>
				    <input type="radio" name="optionsRadios" id="optionsRadios1" value="value" checked>
				    Value
				  </label>
				</div>
				<div class="radio">
				  <label>
				    <input type="radio" name="optionsRadios" id="optionsRadios2" value="future">
				    Future
				  </label>
				</div>
				<div class="radio">
				  <label>
				    <input type="radio" name="optionsRadios" id="optionsRadios3" value="past">
				    Past
				  </label>
				</div>
				<div class="radio">
				  <label>
				    <input type="radio" name="optionsRadios" id="optionsRadios4" value="health">
				    Health
				  </label>
				</div>
				<div class="radio">
				  <label>
				    <input type="radio" name="optionsRadios" id="optionsRadios5" value="income">
				    Income
				  </label>
				</div>
			  </div>
			</div>

            </div>
            <div class="col-sm-9">

				<section class="grids">
				   
				</section>            

             </div>
        </div>
    </div>
</section>



    
    <footer class="footer-section">
      <div class="container">
        <div class="row footer">

          <div class="col-md-3 col-xs-6">
            <h3>Contact</h3>
            <i class="fa fa-phone"></i>
            <a class="btn btn-default btn-large btn-phone btn-alt-border" href="tel:+611300123456">1300 123 456</a>
            <p class="text-center">8:00am - 10:00pm</p>
          </div>

         <div class="col-md-3 col-xs-6 footer-links">
            <h3>Articles</h3>
            <a href="#">Stock</a>
            <a href="#">Bond</a>
            <a href="#">Fund</a>
            <a href="#">Money</a>
            <a href="#">Management</a>
          </div>

          <div class="col-md-3 col-xs-6">
            <h3>Social</h3>
            <a href="#"><i class="fa fa-facebook"></i></a>
            <a href="#"><i class="fa fa-twitter"></i></a>
            <a href="#"><i class="fa fa-linkedin"></i></a>
            <a href="#"><i class="fa fa-google"></i></a>
            <p class="text-center">Follow us</p>
          </div>

          <div class="col-md-3 col-xs-6 footer-links">
            <h3>Links</h3>
            <a href="index.html">Home</a>
            <a href="about.html">About</a>
            <a href="products.html">Products</a>
            <a href="grid.html">Grid</a>
          </div>

        </div>
      </div>

    </footer>
    

    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="js/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="js/bootstrap.min.js"></script>
    <script src="js/main.js"></script>

    

<script src="js/handlebars-v3.0.3.js"></script>

<script id="grid-template" type="text/x-handlebars-template">

    <div class="row blocks" data-autofix='2,2,3'>
        [[#each grids]]
        <div class="col-xs-6 col-md-4">
            <div class="block grid-block white-background">
                <div class="name">
                	<span>[[Name]]([[TickerSymbol]])</span>
                </div>

            	<p>
	                <a href="https://simplywall.st[[logo]]"><img class="logo" src="https://simplywall.st[[logo]]" alt="logo"></a>
            		[[ShortDescription]]
            	</p>

            	<div class="grid-area">
	                <div id='snowflake[[@index]]' class='full-width' style=' background-color:black;'></div>
                </div>
                <div>
                	<a href="https://simplywall.st[[cover]]"><img class="full-width" src="https://simplywall.st[[cover]]" alt="cover"></a>  
                </div>

            </div>
        </div>
        [[/each]]
    </div>
         
</script>

<script type="text/javascript">

Handlebars.setDelimiter = function(start,end){
    //save a reference to the original compile function
    if(!Handlebars.original_compile) Handlebars.original_compile = Handlebars.compile;

    Handlebars.compile = function(source){
        var s = "\\"+start,
            e = "\\"+end,
            RE = new RegExp('('+s+'{2,3})(.*?)('+e+'{2,3})','ig');

            replacedSource = source.replace(RE,function(match, startTags, text, endTags, offset, string){
                var startRE = new RegExp(s,'ig'), endRE = new RegExp(e,'ig');

                startTags = startTags.replace(startRE,'\{');
                endTags = endTags.replace(endRE,'\}');

                return startTags+text+endTags;
            });

        return Handlebars.original_compile(replacedSource);
    };
};

Handlebars.setDelimiter('[',']');
	
(function ($) {

	var source   = $("#grid-template").html();
	var template = Handlebars.compile(source);
	var grids = [];
	var offset = 0;
	var endOfGrid = false;
	var url = "https://simplywall.st/api/grid?query=all&industry=2010000&orderBy=order-by-value&offset=0&maxResults=12";

	function fetchGrid(url, append) {

		append = typeof append !== 'undefined' ? append : false;
		if (!append) {
			offset = 0;
			endOfGrid = false;
		}
		console.log(url);

		$.ajax({
	        url: url
	    }).then(function(data) {
	    	grids = (append) ? grids.concat(data.companies) : data.companies;

	    	console.log(grids);

			var options = {
					background: "https://simplywall.st/images/background13.svg",

					borderMinColor: "#00ff00", // named colours not supported
					borderMaxColor: "#ff0000", // named colours not supported
					borderColorValue: 0, // Snowflake border colour
					borderAlpha: 0.8,
					borderWidth: 1,

					flakeMinColor: "#00ff00", // named colours not supported
					flakeMaxColor: "#ff0000", // named colours not supported
					flakeColorValue: 0, // Snowflake inside colour
					flakeAlpha: 0.5,

					tensor: 1,
					animated: 1,
					easing: 0.5,
					diagnose: false,
					diameter: 0.875 // Proportional to the total available min(height, width)
			};

		    respondCanvas();

			$(window).off("resize", respondCanvas);
		    $(window).resize(respondCanvas);

		    function respondCanvas() {
	 
	 			$('.grids').html("");
		    	$('.grids').append(template({grids: grids}));
		    	app.tuneBlocks();
	 	    	grids.forEach(function(element, index){
					var container = $('#snowflake'+index);
				    var p = container.parent();
				    var width = p.width();

			        p.height(width);
			        container.height(width);
			        container.width(width);

					var s = new SnowFlake(document.getElementById('snowflake'+index));
					s.Render(element.scores, options);

		        });

		    }
	    });

	}

	fetchGrid(url);

    $('input:radio[name=optionsRadios]').change(function () {
    	fetchGrid(url.replace('value', this.value));
    });

    $(window).scroll(function()	{
	    if($(window).scrollTop() == $(document).height() - $(window).height())
	    {
	    	if (!endOfGrid) {
		    	offset += 12;	        
		    	fetchGrid(url.replace('offset=0', 'offset='+offset), true);
		    	if (offset > grids.length) endOfGrid = true;
	    	}
	    }
	});

}(jQuery));

</script>



  </body>
</html>